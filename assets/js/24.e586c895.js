(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{445:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql碎片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql碎片"}},[s._v("#")]),s._v(" MySQL碎片")]),s._v(" "),t("p",[t("code",[s._v("MySQL")]),s._v(" 碎片就是 "),t("code",[s._v("MySQL")]),s._v(" 数据文件中一些不连续的空白空间，这些空间无法再被全部利用，久而久之越来多，越来越零碎，从而造成物理存储和逻辑存储的位置顺序不一致，这就是碎片。")]),s._v(" "),t("h1",{attrs:{id:"碎片的产生"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#碎片的产生"}},[s._v("#")]),s._v(" 碎片的产生")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("delete")]),s._v(" 操作")])]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("MySQL")]),s._v(" 中删除数据，在存储中就会产生空白的空间，当有新数据插入时，"),t("code",[s._v("MySQL")]),s._v(" 会试着在这些空白空间中保存新数据，但是呢总是用不满这些空白空间。所以日积月累，亦或是一下有大量的 "),t("code",[s._v("delete")]),s._v(" 操作，一下就会有大量的空白空间，慢慢的会大到比表的数据使用的空间还大。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("update")]),s._v(" 操作")])]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("MySQL")]),s._v(" 中更新数据，在可变长度的字段（比如 "),t("code",[s._v("varchar")]),s._v("）中更新数据，"),t("code",[s._v("innodb")]),s._v(" 表存储数据的单位是页，"),t("code",[s._v("update")]),s._v(" 操作会造成页分裂，分裂以后存储变的不连续，不规则，从而产生碎片。比如说原始字段长度 "),t("code",[s._v("varchar(100)")]),s._v("，我们大量的更新数据长度位为 "),t("code",[s._v("50")]),s._v("，这样的话，有 "),t("code",[s._v("50")]),s._v(" 的空间被空白了，新入库的数据不能完全利用剩余的 "),t("code",[s._v("50")]),s._v("，这就会产生碎片。")]),s._v(" "),t("h1",{attrs:{id:"碎片的影响"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#碎片的影响"}},[s._v("#")]),s._v(" 碎片的影响")]),s._v(" "),t("ul",[t("li",[s._v("空间浪费")])]),s._v(" "),t("p",[s._v("空间浪费不用多说，碎片占用了大量可用空间。")]),s._v(" "),t("ul",[t("li",[s._v("读写性能下降")])]),s._v(" "),t("p",[s._v("由于存在大量碎片，数据从连续规则的存储方式变为随机分散的存储方式，磁盘 "),t("code",[s._v("IO")]),s._v(" 会变的繁忙，数据库读写性能就会下降。")]),s._v(" "),t("h1",{attrs:{id:"查看碎片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看碎片"}},[s._v("#")]),s._v(" 查看碎片")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 通过表状态信息查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%table_name%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/5f0fc84f4cb14e1fa8a8000e26ad1c02.png",alt:"在这里插入图片描述"}}),s._v(" "),t("code",[s._v("Data_Length")]),s._v(" 表数据大小\n"),t("code",[s._v("Index_Length")]),s._v(" 表索引大小\n"),t("code",[s._v("Data_Free")]),s._v(" 碎片大小")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 通过数据库视图信息查看")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_rows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data_length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("index_length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       concat"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("round")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data_free "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'m'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" data_free\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" information_schema"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),s._v(" t\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("table_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table_name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("code",[s._v("data_free")]),s._v(" 列数据就是我们要查询的表的碎片大小内容")]),s._v(" "),t("h1",{attrs:{id:"清理碎片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清理碎片"}},[s._v("#")]),s._v(" 清理碎片")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 整理数据文件，重新排列索引")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("optimize")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" table_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("OPTIMIZE TABLE")]),s._v("适用于 "),t("code",[s._v("InnoDB")]),s._v("、"),t("code",[s._v("MyISAM")]),s._v(" 和 "),t("code",[s._v("ARCHIVE")]),s._v(" 表"),t("code",[s._v("。OPTIMIZE TABLE")]),s._v("也支持内存中"),t("code",[s._v("NDB")]),s._v("表的动态列。它不适用于内存中表的固定宽度列，也不适用于磁盘数据表。")]),s._v(" "),t("p",[s._v("对于 "),t("code",[s._v("InnoDB")]),s._v(" 表，"),t("code",[s._v("OPTIMIZE TABLE")]),s._v(" 等于 "),t("code",[s._v("ALTER TABLE ... FORC")]),s._v("E，用于重建表以更新索引统计信息并释放聚集索引中未使用的空间。")]),s._v(" "),t("p",[t("code",[s._v("OPTIMIZE TABLE")]),s._v("会锁表，时间长短依据表数据量的大小。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/optimize-table.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 8.0 参考手册"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 重建表的存储引擎，重组数据和索引的存储。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" table_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("engine")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("innodb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-file-defragmenting.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 8.0 参考手册-对表进行碎片整理"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("根据实际情况，只需要每周或者每月整理一次即可")])])}),[],!1,null,null,null);t.default=n.exports}}]);