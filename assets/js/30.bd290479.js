(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{457:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("# SQL概述")]),s._v(" "),t("p",[t("code",[s._v("SQL(Structural query language)")]),s._v("语句分三种类型：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("DML(Data Manipulation Language)")]),s._v("  数据操纵语言")]),s._v(" "),t("li",[t("code",[s._v("DDL(Data Definition Language)")]),s._v(" 数据定义语言")]),s._v(" "),t("li",[t("code",[s._v("DCL(Data Control Language)")]),s._v(" 数据控制语言")])]),s._v(" "),t("h2",{attrs:{id:"dml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dml"}},[s._v("#")]),s._v(" DML")]),s._v(" "),t("p",[t("code",[s._v("DML")]),s._v("用于查询与修改数据记录。包括以下语句：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("INSERT")]),s._v("： 添加数据到数据库中")]),s._v(" "),t("li",[t("code",[s._v("UPDATE")]),s._v("： 修改数据库中的数据")]),s._v(" "),t("li",[t("code",[s._v("DELETE")]),s._v("： 删除数据库中的数据")]),s._v(" "),t("li",[t("code",[s._v("SELECT")]),s._v("： 选择(查询)数据")])]),s._v(" "),t("h2",{attrs:{id:"ddl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ddl"}},[s._v("#")]),s._v(" DDL")]),s._v(" "),t("p",[t("code",[s._v("DDL")]),s._v("用于定义数据库的结构，比如创建、修改或删除数据库对象。包括以下语句")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("CREATE TABLE")]),s._v("：创建数据库表")]),s._v(" "),t("li",[t("code",[s._v("ALTER TABLE")]),s._v("：更改表结构、添加、删除、修改列长度")]),s._v(" "),t("li",[t("code",[s._v("DROP TABLE")]),s._v("：删除表")]),s._v(" "),t("li",[t("code",[s._v("CREATE INDEX")]),s._v("：在表上建立索引")]),s._v(" "),t("li",[t("code",[s._v("DROP INDEX")]),s._v("：删除索引")])]),s._v(" "),t("h2",{attrs:{id:"dcl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dcl"}},[s._v("#")]),s._v(" DCL")]),s._v(" "),t("p",[t("code",[s._v("DCL")]),s._v("用来控制数据库的访问。包括以下语句：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("GRANT")]),s._v("：授予访问权限")]),s._v(" "),t("li",[t("code",[s._v("REVOKE")]),s._v("：撤销访问权限")]),s._v(" "),t("li",[t("code",[s._v("COMMIT")]),s._v("：提交事务处理")]),s._v(" "),t("li",[t("code",[s._v("ROLLBACK")]),s._v("：事务处理回退")]),s._v(" "),t("li",[t("code",[s._v("SAVEPOINT")]),s._v("：设置保存点")]),s._v(" "),t("li",[t("code",[s._v("LOCK")]),s._v("：对数据库的特定部分进行锁定")])]),s._v(" "),t("p",[t("code",[s._v("DESCRIBE tablename")]),s._v("：显示表结构\n"),t("code",[s._v("ESCAPE")]),s._v("：转义符")]),s._v(" "),t("blockquote",[t("p",[s._v("将"),t("code",[s._v("%")]),s._v("转为"),t("code",[s._v("$%")]),s._v("、"),t("code",[s._v("_")]),s._v("转为 "),t("code",[s._v("$_")]),s._v("。然后在后面加上"),t("code",[s._v("ESCAPE '$'")]),s._v(",如果使用"),t("code",[s._v("\\")]),s._v("表示转义，则要省略"),t("code",[s._v("ESCAPE")])])]),s._v(" "),t("h1",{attrs:{id:"mysql数据库推荐规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql数据库推荐规范"}},[s._v("#")]),s._v(" Mysql数据库推荐规范")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210715220350676.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RfQV9JX0hfQV9P,size_16,color_FFFFFF,t_70",alt:"lower('DAIHAO')：变小写upper('daihao')：变大写concat('a','b')：拼接两个字符substr('ABC',)"}})]),s._v(" "),t("blockquote",[t("p",[s._v("阿里巴巴Java开发手册")])]),s._v(" "),t("p",[s._v("(一)\t建表规约")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("【强制】表达是与否概念的字段，必须使用 "),t("code",[s._v("is_xxx")]),s._v(" 的方式命名，数据类型是 "),t("code",[s._v("unsigned tinyint")]),s._v("（1 表示是，0 表示否）。")]),s._v(" "),t("p",[s._v("说明：任何字段如果为非负数，必须是 "),t("code",[s._v("unsigned")]),s._v("。")]),s._v(" "),t("p",[s._v("注意："),t("code",[s._v("POJO")]),s._v(" 类中的任何布尔类型的变量，都不要加 "),t("code",[s._v("is")]),s._v(" 前缀，所以，需要在"),t("code",[s._v("<resultMap>")]),s._v("设置从"),t("code",[s._v("is_xxx")]),s._v("到"),t("code",[s._v("Xxx")]),s._v("的映射关系。数据库表示是与否的值，使用 "),t("code",[s._v("tinyint")]),s._v(" 类型，坚持"),t("code",[s._v("is_xxx")]),s._v(" 的命名方式是为了明确其取值含义与取值范围。")]),s._v(" "),t("p",[s._v("正例：表达逻辑删除的字段名 "),t("code",[s._v("is_deleted")]),s._v("，1 表示删除，0 表示未删除。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】表名、字段名必须使用小写字母或数字，禁止出现数字开头，禁止两个下划线中间只出现数字。数据库字段名的修改代价很大，因为无法进行预发布，所以字段名称需要慎重考虑。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("MySQL")]),s._v("在 "),t("code",[s._v("Windows")]),s._v(" 下不区分大小写，但在 "),t("code",[s._v("Linux")]),s._v(" 下默认是区分大小写。因此，数据库名、表名、字段名，都不允许出现任何大写字母，避免节外生枝。")]),s._v(" "),t("p",[s._v("正例："),t("code",[s._v("aliyun_admin")]),s._v("，"),t("code",[s._v("rdc_config")]),s._v("，"),t("code",[s._v("level3_name")]),s._v(" 反例："),t("code",[s._v("AliyunAdmin")]),s._v("，"),t("code",[s._v("rdcConfig")]),s._v("，"),t("code",[s._v("level_3_name")])])]),s._v(" "),t("li",[t("p",[s._v("【强制】表名不使用复数名词。")]),s._v(" "),t("p",[s._v("说明：表名应该仅仅表示表里面的实体内容，不应该表示实体数量，对应于 "),t("code",[s._v("DO")]),s._v(" 类名也是单数形式，符合表达习惯。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】禁用保留字，如 "),t("code",[s._v("desc、range、match、delayed")]),s._v(" 等，请参考 "),t("code",[s._v("MySQL")]),s._v(" 官方保留字。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】主键索引名为 "),t("code",[s._v("pk_")]),s._v("字段名；唯一索引名为 "),t("code",[s._v("uk_")]),s._v("字段名；普通索引名则为 "),t("code",[s._v("idx_")]),s._v("字段名。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("pk_")]),s._v(" 即"),t("code",[s._v("primary key")]),s._v("；"),t("code",[s._v("uk_")]),s._v(" 即 "),t("code",[s._v("unique key")]),s._v("；"),t("code",[s._v("idx_")]),s._v("即 "),t("code",[s._v("index")]),s._v(" 的简称。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】小数类型为 "),t("code",[s._v("decimal")]),s._v("，禁止使用 "),t("code",[s._v("float")]),s._v(" 和 "),t("code",[s._v("double")]),s._v("。")]),s._v(" "),t("p",[s._v("说明：在存储的时候，"),t("code",[s._v("float")]),s._v(" 和"),t("code",[s._v("double")]),s._v(" 都存在精度损失的问题，很可能在比较值的时候，得到不正确的结果。如果存储的数据范围超过 "),t("code",[s._v("decimal")]),s._v(" 的范围，建议将数据拆成整数和小数并分开存储。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】如果存储的字符串长度几乎相等，使用 "),t("code",[s._v("char")]),s._v(" 定长字符串类型。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】"),t("code",[s._v("varchar")]),s._v(" 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 "),t("code",[s._v("text")]),s._v("，独立出来一张表，用主键来对应，避免影响其它字段索引效率。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】表必备三字段："),t("code",[s._v("id")]),s._v(", "),t("code",[s._v("create_time")]),s._v(", "),t("code",[s._v("update_time")]),s._v("。")]),s._v(" "),t("p",[s._v("说明：其中 "),t("code",[s._v("id")]),s._v("必为主键，类型为"),t("code",[s._v("bigint unsigned")]),s._v("、单表时自增、步长为 1。"),t("code",[s._v("create_time")]),s._v(", "),t("code",[s._v("update_time")]),s._v("的类型均为 "),t("code",[s._v("datetime")]),s._v(" 类型，前者现在时表示主动式创建，后者过去分词表示被动式更新。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】表的命名最好是遵循“业务名称_表的作用”。")]),s._v(" "),t("p",[s._v("正例："),t("code",[s._v("alipay_task / force_project / trade_config")])])]),s._v(" "),t("li",[t("p",[s._v("【推荐】库名与应用名称尽量一致。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】如果修改字段含义或对字段表示的状态追加时，需要及时更新字段注释。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】字段允许适当冗余，以提高查询性能，但必须考虑数据一致。")]),s._v(" "),t("p",[s._v("冗余字段应遵循：\n1）\t不是频繁修改的字段。\n2）\t不是唯一索引的字段。\n3）\t不是 "),t("code",[s._v("varchar")]),s._v(" 超长字段，更不能是"),t("code",[s._v("text")]),s._v(" 字段。")]),s._v(" "),t("p",[s._v("正例：各业务线经常冗余存储商品名称，避免查询时需要调用 IC 服务获取。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】单表行数超过 "),t("code",[s._v("500 万行")]),s._v("或者单表容量超过 "),t("code",[s._v("2GB")]),s._v("，才推荐进行分库分表。")]),s._v(" "),t("p",[s._v("说明：如果预计三年后的数据量根本达不到这个级别，请不要在创建表时就分库分表。")])]),s._v(" "),t("li",[t("p",[s._v("【参考】合适的字符存储长度，不但节约数据库表空间、节约索引存储，更重要的是提升检索速度。")]),s._v(" "),t("p",[s._v("正例：无符号值可以避免误存负数，且扩大了表示范围。\n"),t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210718153738892.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RfQV9JX0hfQV9P,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})])])]),s._v(" "),t("p",[s._v("(二)\t索引规约")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("【强制】业务上具有唯一特性的字段，即使是组合字段，也必须建成唯一索引。")]),s._v(" "),t("p",[s._v("说明：不要以为唯一索引影响了 "),t("code",[s._v("insert")]),s._v(" 速度，这个速度损耗可以忽略，但提高查找速度是明显的；另外， 即使在应用层做了非常完善的校验控制，只要没有唯一索引，根据墨菲定律，必然有脏数据产生。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】超过三个表禁止 "),t("code",[s._v("join")]),s._v("。需要 "),t("code",[s._v("join")]),s._v(" 的字段，数据类型保持绝对一致；多表关联查询时， 保证被关联的字段需要有索引。")]),s._v(" "),t("p",[s._v("说明：即使双表"),t("code",[s._v("join")]),s._v(" 也要注意表索引、"),t("code",[s._v("SQL")]),s._v(" 性能。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】在 "),t("code",[s._v("varchar")]),s._v(" 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度。")]),s._v(" "),t("p",[s._v("说明：索引的长度与区分度是一对矛盾体，一般对字符串类型数据，长度为 20 的索引，区分度会高达 90%以上，可以使用 "),t("code",[s._v("count(distinct left(列名, 索引长度))/count(*)")]),s._v("的区分度来确定。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决。")]),s._v(" "),t("p",[s._v("说明：索引文件具有 "),t("code",[s._v("B-Tree")]),s._v(" 的最左前缀匹配特性，如果左边的值未确定，那么无法使用此索引。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】如果有 "),t("code",[s._v("order by")]),s._v("的场景，请注意利用索引的有序性。"),t("code",[s._v("order by")]),s._v(" 最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现"),t("code",[s._v("file_sort")]),s._v("的情况，影响查询性能。")]),s._v(" "),t("p",[s._v("正例："),t("code",[s._v("where a=? and b=? order by c")]),s._v("; 索引："),t("code",[s._v("a_b_c")])]),s._v(" "),t("p",[s._v("反例：索引如果存在范围查询，那么索引有序性无法利用，如："),t("code",[s._v("WHERE a>10 ORDER BY b")]),s._v("; 索引 "),t("code",[s._v("a_b")]),s._v("无法排序。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】利用覆盖索引来进行查询操作，避免回表。")]),s._v(" "),t("p",[s._v("说明：如果一本书需要知道第 11 章是什么标题，会翻开第 11 章对应的那一页吗？目录浏览一下就好，这个目录就是起到覆盖索引的作用。")]),s._v(" "),t("p",[s._v("正例：能够建立索引的种类分为主键索引、唯一索引、普通索引三种，而覆盖索引只是一种查询的一种效果，用 "),t("code",[s._v("explain")]),s._v(" 的结果，"),t("code",[s._v("extra")]),s._v(" 列会出现："),t("code",[s._v("using index")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】利用延迟关联或者子查询优化超多分页场景。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("MySQL")]),s._v(" 并不是跳过 "),t("code",[s._v("offset")]),s._v(" 行，而是取 "),t("code",[s._v("offset+N")]),s._v(" 行，然后返回放弃前 "),t("code",[s._v("offset")]),s._v(" 行，返回"),t("code",[s._v("N")]),s._v("行，那当"),t("code",[s._v("offset")]),s._v(" 特别大的时候，效率就非常的低下，要么控制返回的总页数，要么对超过特定阈值的页数进行"),t("code",[s._v("SQL")]),s._v(" 改写。")]),s._v(" "),t("p",[s._v("正例：先快速定位需要获取的 id 段，然后再关联："),t("code",[s._v("SELECT t1.* FROM 表 1 as t1, (select id from 表 1 where 条 件 LIMIT 100000,20 ) as t2 where t1.id=t2.id")])])]),s._v(" "),t("li",[t("p",[s._v("【推荐】"),t("code",[s._v("SQL")]),s._v(" 性能优化的目标：至少要达到 "),t("code",[s._v("range")]),s._v(" 级别，要求是 "),t("code",[s._v("ref")]),s._v(" 级别，如果可以是 "),t("code",[s._v("consts")]),s._v("\n最好。")]),s._v(" "),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("1）\t"),t("code",[s._v("consts")]),s._v(" 单表中最多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据。")]),s._v(" "),t("p",[s._v("2）\t"),t("code",[s._v("ref")]),s._v(" 指的是使用普通的索引"),t("code",[s._v("（normal index")]),s._v("。")]),s._v(" "),t("p",[s._v("3）"),t("code",[s._v("range")]),s._v(" 对索引进行范围检索。")]),s._v(" "),t("p",[s._v("反例："),t("code",[s._v("explain")]),s._v(" 表的结果，"),t("code",[s._v("type=index")]),s._v("，索引物理文件全扫描，速度非常慢，这个 "),t("code",[s._v("index")]),s._v(" 级别比较 "),t("code",[s._v("range")]),s._v("还低，与全表扫描是小巫见大巫。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】建组合索引的时候，区分度最高的在最左边。")]),s._v(" "),t("p",[s._v("正例：如果 "),t("code",[s._v("where a=? and b=?")]),s._v("，a 列的几乎接近于唯一值，那么只需要单建 "),t("code",[s._v("idx_a")]),s._v(" 索引即可。")]),s._v(" "),t("p",[s._v("说明：存在非等号和等号混合判断条件时，在建索引时，请把等号条件的列前置。如："),t("code",[s._v("where c>? and d=?")]),s._v("那么即使 c 的区分度更高，也必须把d 放在索引的最前列，即建立组合索引 "),t("code",[s._v("idx_d_c")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】防止因字段类型不同造成的隐式转换，导致索引失效。")])]),s._v(" "),t("li",[t("p",[s._v("【参考】创建索引时避免有如下极端误解：\n1）\t索引宁滥勿缺。认为一个查询就需要建一个索引。\n2）\t吝啬索引的创建。认为索引会消耗空间、严重拖慢记录的更新以及行的新增速度。\n3）\t抵制惟一索引。认为惟一索引一律需要在应用层通过“先查后插”方式解决。")])])]),s._v(" "),t("p",[s._v("(三)\tSQL 语句")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("【强制】不要使用 "),t("code",[s._v("count(列名)")]),s._v("或 "),t("code",[s._v("count(常量)")]),s._v("来替代 "),t("code",[s._v("count(*)")]),s._v("，"),t("code",[s._v("count(*)")]),s._v("是 "),t("code",[s._v("SQL92")]),s._v("定义的标准统计行数的语法，跟数据库无关，跟 "),t("code",[s._v("NULL")]),s._v(" 和非 "),t("code",[s._v("NULL")]),s._v(" 无关。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("count(*)")]),s._v("会统计值为 NULL 的行，而 "),t("code",[s._v("count(列名)")]),s._v("不会统计此列为 "),t("code",[s._v("NULL")]),s._v(" 值的行。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】"),t("code",[s._v("count(distinct col)")]),s._v(" 计算该列除"),t("code",[s._v("NULL")]),s._v(" 之外的不重复行数，注意 "),t("code",[s._v("count(distinct col1, col2)")]),s._v(" 如果其中一列全为 "),t("code",[s._v("NULL")]),s._v("，那么即使另一列有不同的值，也返回为 0。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】当某一列的值全是 "),t("code",[s._v("NULL")]),s._v(" 时，"),t("code",[s._v("count(col)")]),s._v("的返回结果为 0，但 "),t("code",[s._v("sum(col)")]),s._v("的返回结果为NULL，因此使用 "),t("code",[s._v("sum()")]),s._v("时需注意 "),t("code",[s._v("NPE")]),s._v(" 问题。")]),s._v(" "),t("p",[s._v("正例：可以使用如下方式来避免 "),t("code",[s._v("sum")]),s._v(" 的 "),t("code",[s._v("NPE")]),s._v(" 问题："),t("code",[s._v("SELECT IFNULL(SUM(column), 0) FROM table")]),s._v(";")])]),s._v(" "),t("li",[t("p",[s._v("【强制】使用 "),t("code",[s._v("ISNULL()")]),s._v("来判断是否为 "),t("code",[s._v("NULL")]),s._v(" 值。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("NULL")]),s._v(" 与任何值的直接比较都为 "),t("code",[s._v("NULL")]),s._v("。")]),s._v(" "),t("p",[s._v("1）\t"),t("code",[s._v("NULL<>NULL")]),s._v("的返回结果是 "),t("code",[s._v("NULL")]),s._v("，而不是 "),t("code",[s._v("false")]),s._v("。")]),s._v(" "),t("p",[s._v("2）\t"),t("code",[s._v("NULL=NULL")]),s._v(" 的返回结果是 "),t("code",[s._v("NULL")]),s._v("，而不是 "),t("code",[s._v("true")]),s._v("。")]),s._v(" "),t("p",[s._v("3）\t"),t("code",[s._v("NULL<>1")]),s._v("的返回结果是"),t("code",[s._v("NULL")]),s._v("，而不是"),t("code",[s._v("true")]),s._v("。")]),s._v(" "),t("p",[s._v("反例：在"),t("code",[s._v("SQL")]),s._v("语句中，如果在 "),t("code",[s._v("null")]),s._v("前换行，影响可读性。"),t("code",[s._v("select * from table where column1 is null and column3 is not null")]),s._v(" ; 而"),t("code",[s._v("ISNULL(column)")]),s._v("是一个整体，简洁易懂。从性能数据上分析，"),t("code",[s._v("ISNULL(column)")]),s._v(" 执行效率更快一些。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】代码中写分页查询逻辑时，若 "),t("code",[s._v("count")]),s._v(" 为 0 应直接返回，避免执行后面的分页语句。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】不得使用外键与级联，一切外键概念必须在应用层解决。")]),s._v(" "),t("p",[s._v("说明：（概念解释）学生表中的 "),t("code",[s._v("student_id")]),s._v("是主键，那么成绩表中的 "),t("code",[s._v("student_id")]),s._v(" 则为外键。如果更新学生表中的 "),t("code",[s._v("student_id")]),s._v("，同时触发成绩表中的 "),t("code",[s._v("student_id")]),s._v(" 更新，即为"),t("code",[s._v("级联更新")]),s._v("。外键与级联更新适用于单机低并发，不适合分布式、高并发集群；级联更新是强阻塞，存在数据库更新风暴的风险；外键影响数据库的插入速度。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】数据订正（特别是删除或修改记录操作）时，要先 "),t("code",[s._v("select")]),s._v("，避免出现误删除，确认无误才能执行更新语句。")])]),s._v(" "),t("li",[t("p",[s._v("【强制】对于数据库中表记录的查询和变更，只要涉及多个表，都需要在列名前加表的别名（或表名）进行限定。")]),s._v(" "),t("p",[s._v("说明：对多表进行查询记录、更新记录、删除记录时，如果对操作列没有限定表的别名（或表名），并且操作列在多个表中存在时，就会抛异常。")]),s._v(" "),t("p",[s._v("正例："),t("code",[s._v("select t1.name from table_first as t1 , table_second as t2 where t1.id=t2.id;")])]),s._v(" "),t("p",[s._v("反例：在某业务中，由于多表关联查询语句没有加表的别名（或表名）的限制，正常运行两年后，最近在某个表中增加一个同名字段，在预发布环境做数据库变更后，线上查询语句出现出 1052 异常："),t("code",[s._v("Column 'name' in field list is ambiguous")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("【推荐】"),t("code",[s._v("SQL")]),s._v(" 语句中表的别名前加 "),t("code",[s._v("as")]),s._v("，并且以 "),t("code",[s._v("t1、t2、t3、...")]),s._v("的顺序依次命名。")]),s._v(" "),t("p",[s._v("说明：\n1）别名可以是表的简称，或者是依照表在 SQL 语句中出现的顺序，以 "),t("code",[s._v("t1、t2、t3")]),s._v("的方式命名。")]),s._v(" "),t("p",[s._v("2） 别名前加 as 使别名更容易识别。")]),s._v(" "),t("p",[s._v("正例："),t("code",[s._v("select t1.name from table_first as t1, table_second as t2 where t1.id=t2.id;")])])]),s._v(" "),t("li",[t("p",[s._v("【推荐】"),t("code",[s._v("in")]),s._v(" 操作能避免则避免，若实在避免不了，需要仔细评估 in 后边的集合元素数量，控制在 1000 个之内。")])]),s._v(" "),t("li",[t("p",[s._v("【参考】因国际化需要，所有的字符存储与表示，均采用 "),t("code",[s._v("utf8")]),s._v(" 字符集，那么字符计数方法需要注意。")]),s._v(" "),t("p",[s._v("说明：")]),s._v(" "),t("p",[t("code",[s._v('SELECT LENGTH("轻松工作")')]),s._v("； 返回为 12")]),s._v(" "),t("p",[t("code",[s._v('SELECT CHARACTER_LENGTH("轻松工作")')]),s._v("； 返回为 4")]),s._v(" "),t("p",[s._v("如果需要存储表情，那么选择 "),t("code",[s._v("utf8mb4")]),s._v(" 来进行存储，注意它与"),t("code",[s._v("utf8")]),s._v(" 编码的区别。")])]),s._v(" "),t("li",[t("p",[s._v("【参考】"),t("code",[s._v("TRUNCATE TABLE 比 DELETE")]),s._v(" 速度快，且使用的系统和事务日志资源少，但 "),t("code",[s._v("TRUNCATE")]),s._v("\n无事务且不触发 "),t("code",[s._v("trigger")]),s._v("，有可能造成事故，故不建议在开发代码中使用此语句。")]),s._v(" "),t("p",[s._v("说明："),t("code",[s._v("TRUNCATE TABLE")]),s._v(" 在功能上与不带 "),t("code",[s._v("WHERE")]),s._v(" 子句的 "),t("code",[s._v("DELETE")]),s._v("语句相同。")])])]),s._v(" "),t("h1",{attrs:{id:"约束"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#约束"}},[s._v("#")]),s._v(" 约束")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.w3school.com.cn/sql/sql_constraints.asp",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQL 约束 (Constraints)"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"分页"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分页"}},[s._v("#")]),s._v(" 分页")]),s._v(" "),t("ul",[t("li",[s._v("Mysql\n"),t("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210715221111145.png",alt:"在这里插入图片描述"}})]),s._v(" "),t("li",[s._v("Sql Server")])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" tableA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("row_number "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OVER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" tableA"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ASC")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" rownumber \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" tableA "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("temp")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" rowNumber "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("BETWEEN")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" PageNo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" PageSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" PageNo "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" PageNo  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" PageSize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/D_A_I_H_A_O/article/details/107432966",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQL Server中时间戳转换为日期格式"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"sql-server-索引重建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-server-索引重建"}},[s._v("#")]),s._v(" SQL Server 索引重建")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DECLARE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@TableName")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ExecSql")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nset "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ExecSql")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("''        \n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DECLARE")]),s._v(" contact_cursor "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CURSOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FOR")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'U'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("表示所有用户表"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XType")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'S'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("表示所有系统表"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("From")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SYSObjects")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Where")]),s._v(" xType"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'U'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Name")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("OPEN")]),s._v(" contact_cursor\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FETCH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NEXT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FROM")]),s._v(" contact_cursor\ninto "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@TableName")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WHILE")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@FETCH_STATUS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("BEGIN")]),s._v("\n   set "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ExecSql")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ExecSql")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DBCC")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DBREINDEX")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("'"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@TableName")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("')'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Char")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("''\n   "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FETCH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NEXT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FROM")]),s._v(" contact_cursor\n   "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INTO")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@TableName")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("END")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@ExecSql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CLOSE")]),s._v(" contact_cursor\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("DEALLOCATE")]),s._v(" contact_cursor\n"),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("GO")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/wanghao4023030/p/6677251.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQLServer 索引重建"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://download.csdn.net/download/D_A_I_H_A_O/20359660",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mysql xmind 笔记"),t("OutboundLink")],1)]),s._v(" "),t("h1",{attrs:{id:"for-xml-path"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#for-xml-path"}},[s._v("#")]),s._v(" FOR XML PATH")]),s._v(" "),t("p",[s._v("拼接不为空不为null的字段用单引号包括，逗号隔开，"),t("code",[s._v("''")]),s._v("是"),t("code",[s._v("SqlServer")]),s._v("单引号转义语法，一个单引号是报错的，需要两个来代表一个单引号")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''''")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("字段"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''','")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" 表  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" 字段 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("is")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("not")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("null")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" 字段 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" xml path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h1",{attrs:{id:"分割函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分割函数"}},[s._v("#")]),s._v(" 分割函数")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("SqlServer")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Fun_SplitStr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--要分割的字符串")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@split")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--分隔符号")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURNS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Result "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@result")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--定义变量用于接收单个结果 ")]),s._v("\n    \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@split")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n      \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@result")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CHARINDEX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@temp")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--STUFF()函数用于删除指定长度的字符，并可以在指定的起点处插入另一组字符。")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" STUFF"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CHARINDEX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@split")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@originalStr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURN")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\nGO\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[t("strong",[t("code",[s._v("MySql")])])]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFINER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@`%`")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" _string "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VARCHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("StrSeprate "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 求分割符号','的位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" _index "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用临时表存储分割后的结果")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TEMPORARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXISTS")]),s._v(" tmp_strs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TEMPORARY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" tmp_strs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nstr "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNSIGNED")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" _index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LOCATE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("StrSeprate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),s._v(" _index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DO")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" tmp_strs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将子字符串存入临时表")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" _string "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SUBSTR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_string "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" _index"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" _index "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LOCATE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("StrSeprate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHILE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" LENGTH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" tmp_strs "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("_string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" tmp_strs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("drop")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" tmp_strs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);